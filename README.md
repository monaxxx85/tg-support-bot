
## Telegram Support Bot (Laravel 12 + DefStudio Telegraph)

### üìå –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Laravel –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞–∫–µ—Ç **DefStudio/telegraph** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram API.

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

* –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (`/start`, `/help`, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã);
* FSM (Finite State Machine) ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞–º–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç;
* –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞ –æ–±—â–µ–Ω–∏—è;
* –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –∫–µ—à–µ **DefStudio\Telegraph**.

### üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* **–ö–æ–º–∞–Ω–¥—ã Telegram** ‚Äî –±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
* **–°—Ü–µ–Ω–∞—Ä–∏–∏ –Ω–∞ FSM** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π.
* **–û–±—â–∏–π —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏** ‚Äî –æ–±—â–µ–Ω–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—É.
* **–•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** ‚Äî —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Telegraph.
* **–ì–∏–±–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, —Å–µ—Ä–≤–∏—Å—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏.

### üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
App/Telegram
‚îÇ
‚îú‚îÄ‚îÄ Clients/         # –õ–æ–≥–∏–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
‚îú‚îÄ‚îÄ Commands/        # –ö–æ–º–∞–Ω–¥—ã Telegram
‚îú‚îÄ‚îÄ Contracts/       # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îú‚îÄ‚îÄ DTO/             # Data Transfer Objects (—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö)
‚îú‚îÄ‚îÄ Enum/            # –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è (—Å—Ç–∞—Ç—É—Å—ã, –∫–æ–º–∞–Ω–¥—ã –∏ —Ç.–ø.)
‚îú‚îÄ‚îÄ Formatters/      # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º
‚îú‚îÄ‚îÄ FSM/             # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —á–µ—Ä–µ–∑ –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç
‚îú‚îÄ‚îÄ Handlers/        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π, –∫–æ–º–∞–Ω–¥, –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫
‚îú‚îÄ‚îÄ Presenters/      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
‚îú‚îÄ‚îÄ Repository/      # –•—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–µ—Å—Å–∏–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
‚îú‚îÄ‚îÄ Resolvers/       # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω—É–∂–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
‚îú‚îÄ‚îÄ Services/        # –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞
```

### ‚öôÔ∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
composer install
php artisan migrate
# –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ –≤ @BotFather –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω
php artisan telegraph:new-bot
# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∫–æ–º–∞–Ω–¥—ã
php artisan serve --port=8000
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok
ngrok http http://localhost:8000
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ https-–∞–¥—Ä–µ—Å –≤ .env
php artisan telegraph:set-webhook
php artisan schedule:work
```

### üõ† –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É

1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å –≤ `app/Telegram/Commands/`, —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–π –æ—Ç `Telegram/Commands/BaseCommand.php`.
2. –û–ø–∏—à–∏—Ç–µ –º–µ—Ç–æ–¥ `execute()` —Å –ª–æ–≥–∏–∫–æ–π –∫–æ–º–∞–Ω–¥—ã.
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ –∫–æ–Ω—Ñ–∏–≥–µ `src/config/bot.php`.

### üîÑ –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (FSM)

1. –ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è" –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `Telegram/FSM/Scenarios/Registration`.
2. –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å —Å—Ü–µ–Ω–∞—Ä–∏—è ‚Äî `RegistrationScenario.php`, –≤ –Ω—ë–º —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —à–∞–≥–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è.

### üìû –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏

* –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ø–∏–∫ –≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–µ.
* –°–æ–æ–±—â–µ–Ω–∏—è –∏ —Å—Ç–∞—Ç—É—Å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫–µ—à–µ (`SupportChatSessionRepository`).
* –û–ø–µ—Ä–∞—Ç–æ—Ä –∏–ª–∏ –±–æ—Ç –º–æ–≥—É—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Å–µ—Å—Å–∏—é –º–µ–∂–¥—É —Å—Ç–∞—Ç—É—Å–∞–º–∏ (`ChatStatus`).
* –í—Å–µ, –∫—Ç–æ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–µ, –º–æ–≥—É—Ç –æ—Ç–≤–µ—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –Ω–∞—á–∞–≤—à–∏–º –¥–∏–∞–ª–æ–≥ —Å –±–æ—Ç–æ–º.
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞.

### ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
TELEGRAM_BOT_TOKEN=
TELEGRAM_OWNER_BOT=
TELEGRAM_SUPPORT_GROUP_ID=
TELEGRAM_USE_QUEUE=false  # true ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ —Ä–µ–∂–∏–º –æ—á–µ—Ä–µ–¥–µ–π
```


